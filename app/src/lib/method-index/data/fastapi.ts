import { Category } from '../types';

export const fastapi: Category = {
    id: 'fastapi',
    name: 'FastAPI (Full)',
    description: 'Complete FastAPI reference â€” modern async Python web framework with auto-docs, Pydantic, dependency injection',
    icon: 'Rocket',
    entries: [
        { id: 'fapi-setup', name: 'FastAPI App Setup', signature: 'from fastapi import FastAPI; app = FastAPI()', description: 'Create a FastAPI application. Automatically generates OpenAPI docs.', example: 'from fastapi import FastAPI\n\napp = FastAPI(title="My API", version="1.0.0")\n\n@app.get("/")\ndef home():\n    return {"message": "Hello, World!"}\n\n# Run: uvicorn main:app --reload\n# Docs: http://localhost:8000/docs (Swagger UI)\n# Alt:  http://localhost:8000/redoc', tags: ['setup', 'create', 'docs'] },
        { id: 'fapi-path-params', name: 'Path & Query Parameters', signature: '@app.get("/items/{id}") def read(id: int, q: str = None)', description: 'Define path parameters in URL and query parameters as function arguments. Auto-validated.', example: '@app.get("/users/{user_id}")\ndef get_user(user_id: int):\n    return {"user_id": user_id}\n\n@app.get("/items")\ndef list_items(skip: int = 0, limit: int = 10, search: str = None):\n    return {"skip": skip, "limit": limit, "search": search}\n\n# GET /users/42           â†’ {"user_id": 42}\n# GET /items?skip=5&limit=20 â†’ {"skip": 5, ...}\n# GET /users/abc          â†’ 422 Validation Error (not int)', tags: ['path', 'query', 'parameter', 'validation'] },
        { id: 'fapi-request-body', name: 'Request Body (Pydantic)', signature: 'class Item(BaseModel): ...', description: 'Define request body schemas with Pydantic models. Auto-validation and serialization.', example: 'from pydantic import BaseModel, Field\nfrom typing import Optional\n\nclass ItemCreate(BaseModel):\n    name: str = Field(..., min_length=1, max_length=100)\n    price: float = Field(..., gt=0)\n    description: Optional[str] = None\n    tags: list[str] = []\n\n@app.post("/items", status_code=201)\ndef create_item(item: ItemCreate):\n    return {"id": 1, **item.model_dump()}\n\n# POST {"name": "Widget", "price": 9.99}\n# â†’ {"id": 1, "name": "Widget", "price": 9.99, ...}', tags: ['pydantic', 'body', 'validation', 'schema'] },
        { id: 'fapi-response-model', name: 'Response Models', signature: '@app.get("/", response_model=MyModel)', description: 'Define response schema for auto-documentation and data filtering.', example: 'class UserOut(BaseModel):\n    id: int\n    username: str\n    email: str\n    # password NOT included!\n\nclass UserIn(BaseModel):\n    username: str\n    email: str\n    password: str\n\n@app.post("/users", response_model=UserOut)\ndef create_user(user: UserIn):\n    # Save user (password included internally)\n    return {**user.model_dump(), "id": 1}\n    # Response only includes id, username, email', tags: ['response', 'model', 'filter'] },
        { id: 'fapi-status-codes', name: 'Status Codes', signature: 'from fastapi import status', description: 'Return appropriate HTTP status codes for different operations.', example: 'from fastapi import status, HTTPException\n\n@app.post("/items", status_code=status.HTTP_201_CREATED)\ndef create(item: ItemCreate):\n    return item\n\n@app.get("/items/{id}")\ndef get_item(id: int):\n    if id not in items_db:\n        raise HTTPException(\n            status_code=404,\n            detail=f"Item {id} not found"\n        )\n    return items_db[id]\n\n@app.delete("/items/{id}", status_code=status.HTTP_204_NO_CONTENT)\ndef delete_item(id: int):\n    del items_db[id]', tags: ['status', 'http', 'error'] },
        { id: 'fapi-depends', name: 'Dependency Injection', signature: 'from fastapi import Depends', description: 'Inject shared logic (auth, database, pagination) into endpoints with Depends.', example: 'from fastapi import Depends, HTTPException\n\ndef get_db():\n    db = DatabaseSession()\n    try:\n        yield db\n    finally:\n        db.close()\n\ndef get_current_user(token: str = Header(...)):\n    user = decode_token(token)\n    if not user:\n        raise HTTPException(status_code=401)\n    return user\n\n@app.get("/profile")\ndef profile(user = Depends(get_current_user), db = Depends(get_db)):\n    return db.get_user(user.id)\n\n# Common pagination dependency\ndef pagination(skip: int = 0, limit: int = 10):\n    return {"skip": skip, "limit": limit}\n\n@app.get("/items")\ndef list_items(paging = Depends(pagination)):\n    return items[paging["skip"]:paging["skip"]+paging["limit"]]', tags: ['dependency', 'inject', 'shared'] },
        { id: 'fapi-middleware', name: 'Middleware & CORS', signature: 'from fastapi.middleware.cors import CORSMiddleware', description: 'Add middleware for CORS, logging, timing, and request processing.', example: 'from fastapi.middleware.cors import CORSMiddleware\nimport time\n\n# CORS\napp.add_middleware(\n    CORSMiddleware,\n    allow_origins=["http://localhost:3000"],\n    allow_methods=["*"],\n    allow_headers=["*"],\n)\n\n# Custom middleware\n@app.middleware("http")\nasync def add_timing(request, call_next):\n    start = time.time()\n    response = await call_next(request)\n    response.headers["X-Process-Time"] = f"{time.time()-start:.4f}"\n    return response', tags: ['middleware', 'cors', 'timing'] },
        { id: 'fapi-background', name: 'Background Tasks', signature: 'from fastapi import BackgroundTasks', description: 'Run tasks in background after returning the response (emails, notifications, etc.).', example: 'from fastapi import BackgroundTasks\n\ndef send_email(email: str, message: str):\n    # Simulate slow email sending\n    import time\n    time.sleep(5)\n    print(f"Email sent to {email}")\n\n@app.post("/register")\ndef register(email: str, bg: BackgroundTasks):\n    # Register user instantly\n    bg.add_task(send_email, email, "Welcome!")\n    return {"message": "Registered!", "email": email}\n    # Response returns immediately, email sends in background', tags: ['background', 'async', 'task'] },
        { id: 'fapi-file-upload', name: 'File Upload', signature: 'from fastapi import UploadFile, File', description: 'Handle file uploads with automatic streaming and validation.', example: 'from fastapi import UploadFile, File\n\n@app.post("/upload")\nasync def upload(file: UploadFile = File(...)):\n    contents = await file.read()\n    return {\n        "filename": file.filename,\n        "size": len(contents),\n        "content_type": file.content_type\n    }\n\n@app.post("/upload-multiple")\nasync def upload_many(files: list[UploadFile] = File(...)):\n    return [{"name": f.filename} for f in files]', tags: ['upload', 'file', 'multipart'] },
        { id: 'fapi-websocket', name: 'WebSocket', signature: '@app.websocket("/ws")', description: 'Real-time bidirectional communication with WebSocket endpoints.', example: 'from fastapi import WebSocket\n\n@app.websocket("/ws")\nasync def websocket_endpoint(ws: WebSocket):\n    await ws.accept()\n    while True:\n        data = await ws.receive_text()\n        await ws.send_text(f"Echo: {data}")\n\n# Chat room\nconnected = []\n\n@app.websocket("/chat")\nasync def chat(ws: WebSocket):\n    await ws.accept()\n    connected.append(ws)\n    try:\n        while True:\n            msg = await ws.receive_text()\n            for client in connected:\n                await client.send_text(msg)\n    finally:\n        connected.remove(ws)', tags: ['websocket', 'realtime', 'chat'] },
        { id: 'fapi-auth', name: 'OAuth2 / JWT Auth', signature: 'from fastapi.security import OAuth2PasswordBearer', description: 'Implement token-based authentication with OAuth2 and JWT.', example: 'from fastapi.security import OAuth2PasswordBearer, OAuth2PasswordRequestForm\nfrom jose import jwt\nfrom datetime import datetime, timedelta\n\noauth2_scheme = OAuth2PasswordBearer(tokenUrl="token")\nSECRET = "my-secret"\n\ndef create_token(data: dict):\n    expire = datetime.utcnow() + timedelta(hours=1)\n    return jwt.encode({**data, "exp": expire}, SECRET)\n\n@app.post("/token")\ndef login(form: OAuth2PasswordRequestForm = Depends()):\n    user = authenticate(form.username, form.password)\n    token = create_token({"sub": user.username})\n    return {"access_token": token, "token_type": "bearer"}\n\n@app.get("/me")\ndef read_me(token: str = Depends(oauth2_scheme)):\n    payload = jwt.decode(token, SECRET)\n    return {"username": payload["sub"]}', tags: ['auth', 'jwt', 'oauth2', 'token'] },
        { id: 'fapi-router', name: 'APIRouter', signature: 'from fastapi import APIRouter', description: 'Organize endpoints into modules with routers (similar to Flask Blueprints).', example: 'from fastapi import APIRouter\n\n# users/router.py\nrouter = APIRouter(prefix="/users", tags=["users"])\n\n@router.get("/")\ndef list_users():\n    return []\n\n@router.get("/{user_id}")\ndef get_user(user_id: int):\n    return {"id": user_id}\n\n# main.py\nfrom users.router import router as users_router\napp.include_router(users_router)', tags: ['router', 'modular', 'organize'] },
        { id: 'fapi-testing', name: 'Testing with TestClient', signature: 'from fastapi.testclient import TestClient', description: 'Write tests for FastAPI endpoints using the synchronous test client.', example: 'from fastapi.testclient import TestClient\nimport pytest\n\nclient = TestClient(app)\n\ndef test_home():\n    response = client.get("/")\n    assert response.status_code == 200\n    assert response.json() == {"message": "Hello, World!"}\n\ndef test_create_item():\n    response = client.post("/items", json={\n        "name": "Widget",\n        "price": 9.99\n    })\n    assert response.status_code == 201\n    assert response.json()["name"] == "Widget"\n\ndef test_validation_error():\n    response = client.post("/items", json={"name": ""})\n    assert response.status_code == 422', tags: ['testing', 'testclient', 'pytest'] },
        { id: 'fapi-async', name: 'Async Endpoints', signature: 'async def endpoint(): await ...', description: 'FastAPI natively supports async endpoints for high-performance I/O.', example: 'import httpx\n\n@app.get("/fetch")\nasync def fetch_external():\n    async with httpx.AsyncClient() as client:\n        resp = await client.get("https://api.example.com/data")\n        return resp.json()\n\n# Sync endpoints also work (run in threadpool)\n@app.get("/sync")\ndef sync_endpoint():\n    import time\n    time.sleep(1)  # Won\'t block other requests\n    return {"status": "done"}', tags: ['async', 'performance', 'concurrent'] },
        { id: 'fapi-mini-project', name: 'ðŸ”¥ Mini Project: Task Manager API', signature: 'Complete FastAPI CRUD + Auth', description: 'A complete task management API with JWT auth, CRUD, filtering, and pagination.', example: '# Structure:\n# taskmanager/\n#   main.py          â€” App setup, routers\n#   models.py        â€” SQLAlchemy models (User, Task)\n#   schemas.py       â€” Pydantic schemas\n#   database.py      â€” DB session setup\n#   auth/\n#     router.py      â€” Register, login, JWT\n#     utils.py       â€” Password hashing, token creation\n#   tasks/\n#     router.py      â€” CRUD endpoints with filtering\n#\n# Endpoints:\n# POST /auth/register   â€” Create account\n# POST /auth/token      â€” Get JWT\n# GET  /tasks           â€” List (filter: ?status=pending)\n# POST /tasks           â€” Create (auth required)\n# PATCH /tasks/{id}     â€” Update status\n# DELETE /tasks/{id}    â€” Delete (owner only)', tags: ['project', 'taskmanager', 'crud'] },
    ]
};
