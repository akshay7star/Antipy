import { Category } from '../types';

export const databases: Category = {
    id: 'databases',
    name: 'Backend & Databases',
    description: 'SQLite, PostgreSQL, MySQL, MongoDB, SQLAlchemy, Redis — connecting, querying, and ORMs from Python',
    icon: 'Database',
    entries: [
        { id: 'db-sqlite', name: 'SQLite (sqlite3)', signature: 'import sqlite3', description: 'Built-in lightweight SQL database. No setup needed. Stored in a single file.', example: 'import sqlite3\n\n# Connect (creates file if not exists)\nconn = sqlite3.connect("mydb.sqlite")\ncursor = conn.cursor()\n\n# Create table\ncursor.execute("""\n    CREATE TABLE IF NOT EXISTS users (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        name TEXT NOT NULL,\n        email TEXT UNIQUE,\n        age INTEGER\n    )\n""")\n\n# Insert\ncursor.execute("INSERT INTO users (name, email, age) VALUES (?, ?, ?)",\n               ("Alice", "alice@example.com", 30))\n\n# Query\ncursor.execute("SELECT * FROM users WHERE age > ?", (25,))\nfor row in cursor.fetchall():\n    print(row)\n\nconn.commit()\nconn.close()', tags: ['sqlite', 'sql', 'built-in'] },
        { id: 'db-sqlite-context', name: 'SQLite Context Manager', signature: 'with sqlite3.connect("db") as conn: ...', description: 'Use context manager for automatic commit/rollback and proper cleanup.', example: 'import sqlite3\n\nwith sqlite3.connect("mydb.sqlite") as conn:\n    conn.row_factory = sqlite3.Row  # Dict-like rows\n    cursor = conn.cursor()\n\n    # Parameterized queries (prevent SQL injection!)\n    cursor.execute("SELECT * FROM users WHERE name = ?", ("Alice",))\n    user = cursor.fetchone()\n    print(dict(user))  # {\'id\': 1, \'name\': \'Alice\', ...}\n\n    # Insert many\n    users = [("Bob", "bob@ex.com", 25), ("Carol", "carol@ex.com", 28)]\n    cursor.executemany("INSERT INTO users (name, email, age) VALUES (?, ?, ?)", users)', edgeCases: ['Always use ? placeholders.', 'NEVER f-strings for SQL queries (SQL injection!).'], tags: ['sqlite', 'context', 'safe'] },
        { id: 'db-sqlalchemy-core', name: 'SQLAlchemy Setup', signature: 'from sqlalchemy import create_engine', description: 'Python\'s most popular database toolkit. Supports SQLite, PostgreSQL, MySQL, and more.', example: 'from sqlalchemy import create_engine, text\n\n# Connect to different databases\n# SQLite\nengine = create_engine("sqlite:///app.db")\n\n# PostgreSQL\n# engine = create_engine("postgresql://user:pass@localhost/dbname")\n\n# MySQL\n# engine = create_engine("mysql+pymysql://user:pass@localhost/dbname")\n\n# Raw SQL\nwith engine.connect() as conn:\n    result = conn.execute(text("SELECT * FROM users"))\n    for row in result:\n        print(row)\n    conn.commit()', tags: ['sqlalchemy', 'connect', 'setup'] },
        { id: 'db-sqlalchemy-orm', name: 'SQLAlchemy ORM', signature: 'from sqlalchemy.orm import DeclarativeBase, Session', description: 'Define database models as Python classes. Full ORM with relationships, queries, and migrations.', example: 'from sqlalchemy import String, Integer, ForeignKey\nfrom sqlalchemy.orm import DeclarativeBase, Mapped, mapped_column, relationship, Session\n\nclass Base(DeclarativeBase):\n    pass\n\nclass User(Base):\n    __tablename__ = "users"\n    id: Mapped[int] = mapped_column(primary_key=True)\n    name: Mapped[str] = mapped_column(String(100))\n    posts: Mapped[list["Post"]] = relationship(back_populates="author")\n\nclass Post(Base):\n    __tablename__ = "posts"\n    id: Mapped[int] = mapped_column(primary_key=True)\n    title: Mapped[str] = mapped_column(String(200))\n    author_id: Mapped[int] = mapped_column(ForeignKey("users.id"))\n    author: Mapped["User"] = relationship(back_populates="posts")\n\n# Create tables\nBase.metadata.create_all(engine)\n\n# CRUD\nwith Session(engine) as session:\n    user = User(name="Alice")\n    session.add(user)\n    session.commit()\n\n    users = session.query(User).filter(User.name == "Alice").all()', tags: ['sqlalchemy', 'orm', 'model', 'query'] },
        { id: 'db-postgresql', name: 'PostgreSQL (psycopg2)', signature: 'import psycopg2', description: 'Connect to PostgreSQL databases. Production-grade, feature-rich relational database.', example: 'import psycopg2\n\nconn = psycopg2.connect(\n    host="localhost",\n    database="mydb",\n    user="postgres",\n    password="secret"\n)\n\nwith conn.cursor() as cur:\n    cur.execute("""\n        CREATE TABLE IF NOT EXISTS products (\n            id SERIAL PRIMARY KEY,\n            name VARCHAR(100),\n            price DECIMAL(10, 2),\n            created_at TIMESTAMP DEFAULT NOW()\n        )\n    """)\n\n    cur.execute(\n        "INSERT INTO products (name, price) VALUES (%s, %s) RETURNING id",\n        ("Widget", 9.99)\n    )\n    product_id = cur.fetchone()[0]\n    print(f"Created product #{product_id}")\n\nconn.commit()\nconn.close()', tags: ['postgresql', 'psycopg2', 'relational'] },
        { id: 'db-mongodb', name: 'MongoDB (pymongo)', signature: 'from pymongo import MongoClient', description: 'Connect to MongoDB NoSQL database. Document-based, flexible schema.', example: 'from pymongo import MongoClient\n\nclient = MongoClient("mongodb://localhost:27017/")\ndb = client["mydb"]\ncollection = db["users"]\n\n# Insert\ncollection.insert_one({"name": "Alice", "age": 30, "tags": ["admin"]})\n\n# Query\nuser = collection.find_one({"name": "Alice"})\nprint(user)\n\n# Filter\nfor user in collection.find({"age": {"$gt": 25}}).sort("name"):\n    print(user["name"])\n\n# Update\ncollection.update_one({"name": "Alice"}, {"$set": {"age": 31}})\n\n# Delete\ncollection.delete_one({"name": "Alice"})\n\n# Aggregation\npipeline = [\n    {"$group": {"_id": "$age", "count": {"$sum": 1}}}\n]\nresults = collection.aggregate(pipeline)', tags: ['mongodb', 'nosql', 'document'] },
        { id: 'db-redis', name: 'Redis (redis-py)', signature: 'import redis', description: 'In-memory key-value store. Used for caching, sessions, queues, and real-time data.', example: 'import redis\n\nr = redis.Redis(host="localhost", port=6379, decode_responses=True)\n\n# String\nr.set("name", "Alice")\nprint(r.get("name"))  # Alice\n\n# With expiration\nr.setex("session:abc", 3600, "user123")  # Expires in 1 hour\n\n# Hash\nr.hset("user:1", mapping={"name": "Alice", "age": "30"})\nprint(r.hgetall("user:1"))  # {\'name\': \'Alice\', \'age\': \'30\'}\n\n# List (queue)\nr.rpush("queue", "task1", "task2")\ntask = r.lpop("queue")  # "task1"\n\n# Set\nr.sadd("online", "user1", "user2")\nprint(r.smembers("online"))  # {\'user1\', \'user2\'}', tags: ['redis', 'cache', 'key-value'] },
        { id: 'db-mysql', name: 'MySQL (mysql-connector)', signature: 'import mysql.connector', description: 'Connect to MySQL databases from Python.', example: 'import mysql.connector\n\nconn = mysql.connector.connect(\n    host="localhost",\n    user="root",\n    password="secret",\n    database="mydb"\n)\n\ncursor = conn.cursor(dictionary=True)\ncursor.execute("SELECT * FROM users WHERE age > %s", (25,))\n\nfor row in cursor.fetchall():\n    print(row[\"name\"], row[\"age\"])\n\ncursor.close()\nconn.close()', tags: ['mysql', 'relational', 'connector'] },
        { id: 'db-orm-patterns', name: 'ORM Best Practices', signature: 'N/A', description: 'Common patterns and best practices for working with database ORMs.', example: '# 1. Always use parameterized queries\n# ✅ cursor.execute("SELECT * FROM users WHERE id = ?", (user_id,))\n# ❌ cursor.execute(f"SELECT * FROM users WHERE id = {user_id}")\n\n# 2. Use connection pooling in production\n# engine = create_engine("postgresql://...", pool_size=5, max_overflow=10)\n\n# 3. Use migrations for schema changes\n# Never modify tables directly in production\n\n# 4. Index frequently queried columns\n# CREATE INDEX idx_users_email ON users(email)\n\n# 5. Use transactions\n# with session.begin():\n#     session.add(user)\n#     session.add(profile)\n#     # Both succeed or both fail\n\n# 6. Use .first() instead of [0] for single results\n# user = session.query(User).filter_by(email=email).first()', tags: ['best-practices', 'orm', 'security'] },
    ]
};
