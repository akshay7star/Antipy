import { Category } from '../types';

export const flask: Category = {
    id: 'flask',
    name: 'Flask (Full)',
    description: 'Complete Flask web framework reference â€” routes, templates, request handling, blueprints, extensions, and a mini blog API project',
    icon: 'Globe',
    entries: [
        { id: 'flask-app', name: 'Flask App Setup', signature: 'from flask import Flask; app = Flask(__name__)', description: 'Create a Flask application instance. The starting point for every Flask project.', example: 'from flask import Flask\n\napp = Flask(__name__)\n\n@app.route("/")\ndef home():\n    return "Hello, World!"\n\nif __name__ == "__main__":\n    app.run(debug=True)', tags: ['flask', 'setup', 'create'] },
        { id: 'flask-routes', name: '@app.route()', signature: '@app.route("/path", methods=["GET", "POST"])', description: 'Define URL routes and map them to view functions. Supports multiple HTTP methods.', example: '@app.route("/")\ndef home():\n    return "Home Page"\n\n@app.route("/user/<username>")\ndef profile(username):\n    return f"User: {username}"\n\n@app.route("/post/<int:post_id>")\ndef show_post(post_id):\n    return f"Post #{post_id}"\n\n@app.route("/login", methods=["GET", "POST"])\ndef login():\n    if request.method == "POST":\n        return "Logging in..."\n    return "Login form"', tags: ['route', 'url', 'endpoint'] },
        { id: 'flask-request', name: 'request Object', signature: 'from flask import request', description: 'Access incoming request data â€” form data, query strings, JSON, files, headers, and cookies.', example: 'from flask import request\n\n@app.route("/search")\ndef search():\n    query = request.args.get("q", "")  # Query string\n    return f"Searching: {query}"\n\n@app.route("/login", methods=["POST"])\ndef login():\n    username = request.form["username"]  # Form data\n    return f"Welcome, {username}"\n\n@app.route("/api/data", methods=["POST"])\ndef api_data():\n    data = request.get_json()  # JSON body\n    return {"received": data}', tags: ['request', 'form', 'query', 'json'] },
        { id: 'flask-response', name: 'Response & Redirect', signature: 'from flask import jsonify, redirect, url_for', description: 'Create responses, return JSON, redirect to other routes.', example: 'from flask import jsonify, redirect, url_for, make_response\n\n@app.route("/api/users")\ndef get_users():\n    users = [{"name": "Alice"}, {"name": "Bob"}]\n    return jsonify(users)  # JSON response\n\n@app.route("/old-page")\ndef old_page():\n    return redirect(url_for("home"))  # Redirect to home()\n\n@app.route("/custom")\ndef custom():\n    resp = make_response("Hello", 200)\n    resp.headers["X-Custom"] = "value"\n    return resp', tags: ['response', 'json', 'redirect'] },
        { id: 'flask-templates', name: 'Jinja2 Templates', signature: 'from flask import render_template', description: 'Render HTML templates with Jinja2. Supports variables, loops, conditionals, filters, and template inheritance.', example: 'from flask import render_template\n\n@app.route("/hello/<name>")\ndef hello(name):\n    return render_template("hello.html", name=name)\n\n# templates/hello.html:\n# <h1>Hello, {{ name }}!</h1>\n# {% for i in range(3) %}\n#   <p>{{ i }}</p>\n# {% endfor %}\n# {{ name|upper }} â€” Filter\n# {% if name == "admin" %}\n#   <p>Welcome, admin!</p>\n# {% endif %}', tags: ['template', 'jinja2', 'html'] },
        { id: 'flask-template-inheritance', name: 'Template Inheritance', signature: '{% extends "base.html" %} {% block content %}{% endblock %}', description: 'Create reusable page layouts with base templates and child overrides.', example: '# templates/base.html:\n# <!DOCTYPE html>\n# <html>\n# <head><title>{% block title %}{% endblock %}</title></head>\n# <body>\n#   <nav>...</nav>\n#   {% block content %}{% endblock %}\n# </body></html>\n\n# templates/home.html:\n# {% extends "base.html" %}\n# {% block title %}Home{% endblock %}\n# {% block content %}\n#   <h1>Welcome!</h1>\n# {% endblock %}', tags: ['template', 'inheritance', 'layout'] },
        { id: 'flask-flash', name: 'flash() Messages', signature: 'from flask import flash, get_flashed_messages', description: 'Display one-time messages to the user (success, error notifications).', example: 'from flask import flash, redirect, url_for\n\n@app.route("/save", methods=["POST"])\ndef save():\n    # Save data...\n    flash("Saved successfully!", "success")\n    return redirect(url_for("home"))\n\n# In template:\n# {% for category, message in get_flashed_messages(with_categories=true) %}\n#   <div class="alert alert-{{ category }}">{{ message }}</div>\n# {% endfor %}', tags: ['flash', 'message', 'notification'] },
        { id: 'flask-blueprints', name: 'Blueprints', signature: 'from flask import Blueprint', description: 'Organize large applications into modular components with blueprints.', example: 'from flask import Blueprint\n\n# auth/routes.py\nauth = Blueprint("auth", __name__, url_prefix="/auth")\n\n@auth.route("/login")\ndef login():\n    return "Login page"\n\n@auth.route("/register")\ndef register():\n    return "Register page"\n\n# app.py\nfrom auth.routes import auth\napp.register_blueprint(auth)', tags: ['blueprint', 'modular', 'organize'] },
        { id: 'flask-session', name: 'Sessions', signature: 'from flask import session', description: 'Store user-specific data across requests using signed cookies.', example: 'from flask import session\n\napp.secret_key = "super-secret-key"\n\n@app.route("/login", methods=["POST"])\ndef login():\n    session["username"] = request.form["username"]\n    return redirect(url_for("profile"))\n\n@app.route("/profile")\ndef profile():\n    if "username" not in session:\n        return redirect(url_for("login"))\n    return f"Welcome, {session[\'username\']}"\n\n@app.route("/logout")\ndef logout():\n    session.pop("username", None)\n    return redirect(url_for("home"))', tags: ['session', 'auth', 'cookies'] },
        { id: 'flask-error-handler', name: 'Error Handlers', signature: '@app.errorhandler(404)', description: 'Custom error pages for HTTP error codes.', example: '@app.errorhandler(404)\ndef not_found(error):\n    return render_template("404.html"), 404\n\n@app.errorhandler(500)\ndef server_error(error):\n    return render_template("500.html"), 500\n\n# API error handlers\n@app.errorhandler(404)\ndef api_not_found(error):\n    return jsonify({"error": "Not found"}), 404', tags: ['error', 'handler', '404', '500'] },
        { id: 'flask-middleware', name: 'Middleware & Hooks', signature: '@app.before_request / @app.after_request', description: 'Run code before or after each request. Useful for auth checks, logging, CORS.', example: '@app.before_request\ndef check_auth():\n    if request.endpoint != "login":\n        if "user" not in session:\n            return redirect(url_for("login"))\n\n@app.after_request\ndef add_headers(response):\n    response.headers["X-Frame-Options"] = "DENY"\n    return response', tags: ['middleware', 'hook', 'before', 'after'] },
        { id: 'flask-static', name: 'Static Files', signature: 'url_for("static", filename="style.css")', description: 'Serve CSS, JavaScript, and image files from the /static directory.', example: '# Place files in: /static/css/style.css, /static/js/app.js\n\n# In template:\n# <link rel="stylesheet" href="{{ url_for(\'static\', filename=\'css/style.css\') }}">\n# <script src="{{ url_for(\'static\', filename=\'js/app.js\') }}"></script>\n# <img src="{{ url_for(\'static\', filename=\'images/logo.png\') }}"/>', tags: ['static', 'css', 'js', 'files'] },
        { id: 'flask-sqlalchemy', name: 'Flask-SQLAlchemy', signature: 'from flask_sqlalchemy import SQLAlchemy', description: 'Database ORM integration for Flask. Define models as Python classes.', example: 'from flask_sqlalchemy import SQLAlchemy\n\napp.config["SQLALCHEMY_DATABASE_URI"] = "sqlite:///app.db"\ndb = SQLAlchemy(app)\n\nclass User(db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    username = db.Column(db.String(80), unique=True)\n    email = db.Column(db.String(120))\n\n    def __repr__(self):\n        return f"<User {self.username}>"\n\n# Create tables\nwith app.app_context():\n    db.create_all()\n\n# CRUD\nuser = User(username="alice", email="alice@example.com")\ndb.session.add(user)\ndb.session.commit()\n\nusers = User.query.all()\nuser = User.query.filter_by(username="alice").first()', tags: ['database', 'orm', 'sqlalchemy'] },
        { id: 'flask-login', name: 'Flask-Login', signature: 'from flask_login import LoginManager, login_user, logout_user', description: 'User session management â€” login, logout, and protecting routes.', example: 'from flask_login import LoginManager, UserMixin, login_user, logout_user, login_required\n\nlogin_manager = LoginManager(app)\nlogin_manager.login_view = "login"\n\nclass User(UserMixin, db.Model):\n    id = db.Column(db.Integer, primary_key=True)\n    username = db.Column(db.String(80))\n    password_hash = db.Column(db.String(128))\n\n@login_manager.user_loader\ndef load_user(user_id):\n    return User.query.get(int(user_id))\n\n@app.route("/protected")\n@login_required\ndef protected():\n    return f"Hello, {current_user.username}!"', tags: ['auth', 'login', 'session', 'protected'] },
        { id: 'flask-wtf', name: 'Flask-WTF (Forms)', signature: 'from flask_wtf import FlaskForm', description: 'Form handling with CSRF protection, validation, and rendering.', example: 'from flask_wtf import FlaskForm\nfrom wtforms import StringField, PasswordField\nfrom wtforms.validators import DataRequired, Email\n\nclass LoginForm(FlaskForm):\n    email = StringField("Email", validators=[DataRequired(), Email()])\n    password = PasswordField("Password", validators=[DataRequired()])\n\n@app.route("/login", methods=["GET", "POST"])\ndef login():\n    form = LoginForm()\n    if form.validate_on_submit():\n        # Process login\n        return redirect(url_for("home"))\n    return render_template("login.html", form=form)', tags: ['forms', 'validation', 'csrf'] },
        { id: 'flask-migrate', name: 'Flask-Migrate', signature: 'from flask_migrate import Migrate', description: 'Database schema migrations using Alembic. Track and apply database changes.', example: 'from flask_migrate import Migrate\n\nmigrate = Migrate(app, db)\n\n# CLI commands:\n# flask db init          â€” Initialize migrations\n# flask db migrate -m "Add users"  â€” Create migration\n# flask db upgrade       â€” Apply migration\n# flask db downgrade     â€” Rollback migration', tags: ['migration', 'database', 'schema'] },
        { id: 'flask-restful', name: 'Flask-RESTful', signature: 'from flask_restful import Api, Resource', description: 'Build REST APIs with class-based resource views.', example: 'from flask_restful import Api, Resource\n\napi = Api(app)\n\nclass UserResource(Resource):\n    def get(self, user_id):\n        user = User.query.get_or_404(user_id)\n        return {"id": user.id, "name": user.username}\n\n    def put(self, user_id):\n        user = User.query.get_or_404(user_id)\n        user.username = request.json["name"]\n        db.session.commit()\n        return {"id": user.id, "name": user.username}\n\n    def delete(self, user_id):\n        user = User.query.get_or_404(user_id)\n        db.session.delete(user)\n        db.session.commit()\n        return "", 204\n\napi.add_resource(UserResource, "/api/users/<int:user_id>")', tags: ['rest', 'api', 'resource'] },
        { id: 'flask-testing', name: 'Testing Flask Apps', signature: 'app.test_client()', description: 'Write tests for Flask applications using the built-in test client.', example: 'import pytest\n\n@pytest.fixture\ndef client():\n    app.config["TESTING"] = True\n    with app.test_client() as client:\n        yield client\n\ndef test_home(client):\n    response = client.get("/")\n    assert response.status_code == 200\n    assert b"Hello" in response.data\n\ndef test_api(client):\n    response = client.post("/api/data",\n        json={"name": "Alice"},\n        content_type="application/json"\n    )\n    assert response.status_code == 200\n    assert response.json["received"]["name"] == "Alice"', tags: ['testing', 'test-client', 'pytest'] },
        { id: 'flask-app-factory', name: 'Application Factory', signature: 'def create_app(config): ...', description: 'Factory pattern for creating Flask apps. Enables testing and multiple configurations.', example: 'def create_app(config_name="default"):\n    app = Flask(__name__)\n    app.config.from_object(config[config_name])\n\n    db.init_app(app)\n    migrate.init_app(app, db)\n    login_manager.init_app(app)\n\n    from .auth import auth as auth_bp\n    app.register_blueprint(auth_bp)\n\n    from .main import main as main_bp\n    app.register_blueprint(main_bp)\n\n    return app', tags: ['factory', 'pattern', 'config'] },
        { id: 'flask-g', name: 'g (Application Context)', signature: 'from flask import g', description: 'Per-request global storage. Store data that\'s valid for the current request only.', example: 'from flask import g\n\n@app.before_request\ndef load_user():\n    token = request.headers.get("Authorization")\n    g.user = get_user_from_token(token) if token else None\n\n@app.route("/profile")\ndef profile():\n    if g.user is None:\n        return "Unauthorized", 401\n    return f"Hello, {g.user.name}"', tags: ['context', 'global', 'per-request'] },
        { id: 'flask-jinja-filters', name: 'Jinja2 Filters & Macros', signature: '{{ value|filter }} {% macro name() %} ... {% endmacro %}', description: 'Transform template values with filters, create reusable template components with macros.', example: '# Built-in filters:\n# {{ name|upper }}         â†’ ALICE\n# {{ name|lower }}         â†’ alice\n# {{ items|length }}       â†’ 5\n# {{ price|round(2) }}     â†’ 9.99\n# {{ html|safe }}          â†’ Render as HTML\n# {{ items|join(", ") }}   â†’ a, b, c\n# {{ text|truncate(50) }}  â†’ First 50 chars...\n\n# Custom filter\n@app.template_filter("reverse")\ndef reverse_filter(s):\n    return s[::-1]\n\n# Macro\n# {% macro button(text, type="primary") %}\n#   <button class="btn btn-{{ type }}">{{ text }}</button>\n# {% endmacro %}\n# {{ button("Click me") }}', tags: ['filter', 'macro', 'jinja2'] },
        { id: 'flask-mini-project', name: 'ðŸ”¥ Mini Project: Blog API', signature: 'Complete Flask REST API', description: 'A complete blog API with CRUD operations, authentication, and database. Reference implementation.', example: '# Structure:\n# blog/\n#   __init__.py      (app factory)\n#   models.py        (Post, User models)\n#   auth/routes.py   (login, register)\n#   posts/routes.py  (CRUD endpoints)\n#\n# Key endpoints:\n# POST /auth/register   â€” Create account\n# POST /auth/login      â€” Get JWT token\n# GET  /posts           â€” List all posts\n# POST /posts           â€” Create post (auth required)\n# GET  /posts/<id>      â€” Get single post\n# PUT  /posts/<id>      â€” Update post (author only)\n# DELETE /posts/<id>    â€” Delete post (author only)', tags: ['project', 'blog', 'api', 'crud'] },
        { id: 'flask-config', name: 'Configuration', signature: 'app.config["KEY"] = value', description: 'Manage app settings with config objects, environment variables, or files.', example: 'import os\n\n# Direct setting\napp.config["SECRET_KEY"] = "dev-key"\napp.config["SQLALCHEMY_DATABASE_URI"] = "sqlite:///app.db"\n\n# From environment\napp.config["SECRET_KEY"] = os.environ.get("SECRET_KEY", "dev-fallback")\n\n# From object\nclass Config:\n    SECRET_KEY = os.environ.get("SECRET_KEY")\n    SQLALCHEMY_DATABASE_URI = os.environ.get("DATABASE_URL")\n\nclass DevConfig(Config):\n    DEBUG = True\n\nclass ProdConfig(Config):\n    DEBUG = False\n\napp.config.from_object(DevConfig)', tags: ['config', 'settings', 'environment'] },
        { id: 'flask-cors', name: 'CORS', signature: 'from flask_cors import CORS', description: 'Enable Cross-Origin Resource Sharing for API access from different domains.', example: 'from flask_cors import CORS\n\n# Allow all origins\nCORS(app)\n\n# Specific origins\nCORS(app, origins=["http://localhost:3000"])\n\n# Per-route\n@app.route("/api/data")\n@cross_origin()\ndef get_data():\n    return jsonify({"data": "value"})', tags: ['cors', 'cross-origin', 'api'] },
    ]
};
